$(document).ready(function () {
    var f;
    var d;
    d = L.map("map").setView([0, 0], 2);
    var a = new L.StamenTileLayer("toner", {detectRetina: true});
    a.addTo(d);
    var e = function (g, h, j) {
        var i = {topic: g, key: "2aa7c18485e27a1f39a4746226b", sign: true, page: h, ordering: "members"};
        if (j) {
            i.lat = j.lat;
            i.lon = j.lng
        }
        $.ajax({
            url: "http://api.meetup.com/2/groups", data: i, type: "GET", dataType: "jsonp", success: function (o) {
                if (f) {
                    d.removeLayer(f)
                }
                var n = new L.LinearFunction(new L.Point(5, 5), new L.Point(10000, 50));
                var k = new L.HSLHueFunction(new L.Point(0, 360), new L.Point(5, 200), {
                    outputSaturation: "100%",
                    outputLuminosity: "25%"
                });
                var m = new L.HSLHueFunction(new L.Point(0, 360), new L.Point(5, 200), {
                    outputSaturation: "100%",
                    outputLuminosity: "50%"
                });
                var l = {
                    recordsField: "results",
                    latitudeField: "lat",
                    longitudeField: "lon",
                    displayOptions: {
                        members: {displayName: "Members", radius: n},
                        rating: {
                            displayName: "Rating", fillColor: m, color: k, displayText: function (q) {
                                if (q === null) {
                                    q = "N/A"
                                }
                                return q
                            }
                        }
                    },
                    layerOptions: {
                        weight: 1,
                        fillOpacity: 0.7,
                        opacity: 1,
                        numberOfSides: 50,
                        gradient: true,
                        dropShadow: true
                    },
                    tooltipOptions: {iconSize: new L.Point(100, 75), iconAnchor: new L.Point(-5, 75)},
                    onEachRecord: function (r, q) {
                        $html = $(L.HTMLUtils.buildTable(q));
                        r.bindPopup($html.wrap("<div/>").parent().html(), {minWidth: 400, maxWidth: 400})
                    }
                };
                f = new L.DataLayer(o, l);
                d.addLayer(f);
                var p = $("#legend");
                p.empty();
                p.append(f.getLegend({className: "well"}))
            }
        })
    };
    var b = $("#meetup-topic");
    var c = $("#find-meetups-button");
    c.on("click", function (h) {
        h.preventDefault();
        var g = b.val();
        e(g, 200, d.getBounds().getCenter())
    })
});