map=null;var lastLayer;var legendControl;var eqfeed_callback=function(g){var b=new L.HSLHueFunction(new L.Point(0,90),new L.Point(10,0),{outputSaturation:"100%",outputLuminosity:"25%"});var a=new L.HSLHueFunction(new L.Point(0,90),new L.Point(10,0),{outputSaturation:"100%",outputLuminosity:"50%"});var i=new L.LinearFunction(new L.Point(0,10),new L.Point(10,30));var d=Math.round((new Date()).getTime());var c=d-86400000;var f=new L.LinearFunction(new L.Point(c,0.3),new L.Point(d,1));var e=new L.LinearFunction(new L.Point(0,8),new L.Point(10,24));var j=function(k){return{text:k,style:{"font-size":e.evaluate(k)}}};var h=new L.DataLayer(g,{recordsField:"features",latitudeField:"geometry.coordinates.1",longitudeField:"geometry.coordinates.0",locationMode:L.LocationModes.LATLNG,displayOptions:{"properties.mag":{displayName:"Magnitude",color:b,fillColor:a,radius:i,text:j},"properties.time":{displayName:"Time",opacity:f,fillOpacity:f,displayText:function(k){return moment.unix(k/1000).format("MM/DD/YY HH:mm")}}},layerOptions:{numberOfSides:4,radius:10,weight:1,color:"#000",opacity:0.2,stroke:true,fillOpacity:0.7,dropShadow:true,gradient:true},tooltipOptions:{iconSize:new L.Point(90,76),iconAnchor:new L.Point(-4,76)},onEachRecord:function(n,m,l){var k=$(L.HTMLUtils.buildTable(m));n.bindPopup(k.wrap("<div/>").parent().html(),{minWidth:400,maxWidth:400})}});map.addLayer(h);lastLayer=h};$(document).ready(function(){var d=function(){var g=$("#map");g.height($(window).height()-$("div.navbar").outerHeight());if(map){map.invalidateSize()}};$(window).on("resize",function(){d()});d();map=L.map("map").setView([0,0],2);var c=new L.StamenTileLayer("toner",{detectRetina:true});c.addTo(map);var e=L.tileLayer("http://{s}.tiles.mapbox.com/v3/bclc-apec.map-rslgvy56/{z}/{x}/{y}.png",{attribution:'Map &copy; Pacific Rim Coordination Center (PRCC).  Certain data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});var f=new L.Control.Legend();f.addTo(map);var b=new L.Control.Layers({"Stamen Toner":c,"PRCC Earthquake Risk Zones":e});b.addTo(map);var a=function(){if(lastLayer){map.removeLayer(lastLayer)}$.ajax({url:"http://earthquake.usgs.gov/earthquakes/feed/geojsonp/all/day",type:"GET",dataType:"jsonp"})};a();setInterval(a,300000)});