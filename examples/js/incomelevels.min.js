$(document).ready(function () {
    var u;
    var e = new L.StamenTileLayer("toner", {detectRetina: true});
    var t = {"Stamen Toner": e};
    u = L.map("map", {layers: [e]}).setView([0, 0], 2);
    var p = ["OEC", "NOC", "UMC", "MIC", "LMC", "LIC", "HPC"];
    var h = [{id: "HIC", value: "High income"}, {
        id: "HPC",
        value: "Heavily indebted poor countries (HIPC)"
    }, {id: "INX", value: "Not classified"}, {id: "LIC", value: "Low income"}, {
        id: "LMC",
        value: "Lower middle income"
    }, {id: "LMY", value: "Low & middle income"}, {id: "MIC", value: "Middle income"}, {
        id: "NOC",
        value: "High income: nonOECD"
    }, {id: "OEC", value: "High income: OECD"}, {id: "UMC", value: "Upper middle income"}];
    var l = function (z) {
        var B = {};
        for (var y = 0; y < z.length; ++y) {
            var A = z[y];
            B[A.id] = A.value
        }
        return B
    };
    var j = l(h);
    var v = function (y) {
        return j[p[y]]
    };
    var n = new L.HSLLuminosityFunction(new L.Point(0, 0.2), new L.Point(p.length - 1, 0.75), {
        outputHue: 0,
        outputLuminosity: "100%"
    });
    var a = new L.HSLLuminosityFunction(new L.Point(0, 0.5), new L.Point(p.length - 1, 1), {
        outputHue: 0,
        outputLuminosity: "100%"
    });
    var n = new L.HSLHueFunction(new L.Point(0, 240), new L.Point(p.length - 1, 0), {
        outputSaturation: "100%",
        outputLuminosity: "25%"
    });
    var a = new L.HSLHueFunction(new L.Point(0, 240), new L.Point(p.length - 1, 0), {
        outputSaturation: "100%",
        outputLuminosity: "50%"
    });
    var n = new L.HSLLuminosityFunction(new L.Point(0, 0.5), new L.Point(p.length - 1, 0.1), {
        outputHue: 27,
        outputLuminosity: "100%"
    });
    var a = new L.HSLLuminosityFunction(new L.Point(0, 0.5), new L.Point(p.length - 1, 0.2), {
        outputHue: 27,
        outputLuminosity: "100%"
    });
    var k = new L.StylesBuilder(p, {displayName: v, color: n, fillColor: a});
    var d = {
        recordsField: "1",
        locationMode: L.LocationModes.COUNTRY,
        codeField: "id",
        displayOptions: {"incomeLevel.id": {displayName: "Income Level", styles: k.getStyles()}},
        layerOptions: {fillOpacity: 0.7, opacity: 1, weight: 1},
        tooltipOptions: {iconSize: new L.Point(100, 65), iconAnchor: new L.Point(-5, 65)},
        onEachRecord: function (A, z) {
            var y = $(L.HTMLUtils.buildTable(z));
            A.bindPopup(y.wrap("<div/>").parent().html(), {maxWidth: 400, minWidth: 400})
        }
    };
    var i = new L.ChoroplethDataLayer(incomeLevels, d);
    u.addLayer(i);
    $("#legend").append(i.getLegend({className: "well"}));
    var s = new L.HSLHueFunction(new L.Point(0, 90), new L.Point(300000000, 0), {
        outputSaturation: "100%",
        outputLuminosity: "30%"
    });
    var c = new L.HSLHueFunction(new L.Point(0, 90), new L.Point(300000000, 0));
    d = {
        recordsField: null,
        locationMode: L.LocationModes.COUNTRY,
        codeField: "CountryCode",
        displayOptions: {"2010": {displayName: "Telephone Lines", color: s, fillColor: c}},
        layerOptions: {fillOpacity: 0.7, opacity: 1, weight: 1},
        tooltipOptions: {iconSize: new L.Point(100, 65), iconAnchor: new L.Point(-5, 65)},
        onEachRecord: function (A, z) {
            var y = $(L.HTMLUtils.buildTable(z));
            A.bindPopup(y.wrap("<div/>").parent().html(), {maxWidth: 400, minWidth: 400})
        }
    };
    var r = new L.ChoroplethDataLayer(telephoneLines, d);
    $("#legend").append(r.getLegend({className: "well"}));
    var q = ["1995", "2000", "2005", "2010"];
    var f = new L.HSLLuminosityFunction(new L.Point(0, 0.5), new L.Point(q.length - 1, 1), {
        outputHue: 0,
        outputSaturation: "100%"
    });
    var m = new L.StylesBuilder(q, {
        displayName: function (y) {
            return q[y]
        }, color: "hsl(0,100%,20%)", fillColor: f, minValue: 0, maxValue: 20000000
    });
    d = {
        recordsField: null,
        locationMode: L.LocationModes.COUNTRY,
        codeField: "CountryCode",
        chartOptions: m.getStyles(),
        layerOptions: {fillOpacity: 0.7, opacity: 1, weight: 1, width: 6},
        tooltipOptions: {iconSize: new L.Point(100, 65), iconAnchor: new L.Point(-5, 65)},
        onEachRecord: function (A, z) {
            var y = $(L.HTMLUtils.buildTable(z));
            A.bindPopup(y.wrap("<div/>").parent().html(), {maxWidth: 400, minWidth: 400})
        }
    };
    var x = new L.BarChartDataLayer(telephoneLines, d);
    $("#legend").append(x.getLegend({className: "well", title: "Telephone Lines"}));
    var o = new L.HSLSaturationFunction(new L.Point(0, 0.1), new L.Point(100, 1), {
        outputHue: 220,
        outputLuminosity: "50%"
    });
    var g = new L.LinearFunction(new L.Point(0, 2), new L.Point(100, 10));
    d = {
        recordsField: null,
        locationMode: L.LocationModes.COUNTRY,
        codeField: "CountryCode",
        displayOptions: {"2010": {displayName: "Solid Fuel Use (%)", fillColor: o, radius: g}},
        layerOptions: {
            fillOpacity: 0.7,
            opacity: 1,
            weight: 1,
            color: "hsl(220,100%,25%)",
            numberOfSides: 40,
            dropShadow: true,
            gradient: true
        },
        tooltipOptions: {iconSize: new L.Point(100, 65), iconAnchor: new L.Point(-5, 65)},
        onEachRecord: function (A, z) {
            var y = $(L.HTMLUtils.buildTable(z));
            A.bindPopup(y.wrap("<div/>").parent().html(), {maxWidth: 400, minWidth: 400})
        }
    };
    var b = new L.DataLayer(solidFuels, d);
    $("#legend").append(b.getLegend({className: "well"}));
    var w = {"Income Levels": i, "Telephone Lines": r, "Telephone Lines by Year": x, "Solid Fuel Use": b};
    L.control.layers(t, w).addTo(u)
});